from aiogram import Router, F
from aiogram.types import Message
from config import logger, ADMIN_PASSWORD
from db.functions import register_user
from aiogram.fsm.context import FSMContext
from aiogram.fsm.state import State, StatesGroup
from keyboard import main_keyboard
import hashlib


class AdminPassword(StatesGroup):
    password = State()


start_router = Router()


@start_router.message(F.text == "/start")
async def start(message: Message):
    try:
        await register_user(message)
        text = """
    üçΩÔ∏è –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º –≤–∞—Å –≤ @EasyCalloriesBot! üç¥

    –ú—ã —Ä–∞–¥—ã –ø–æ–º–æ—á—å –≤–∞–º —Å–ª–µ–¥–∏—Ç—å –∑–∞ –≤–∞—à–∏–º —Ä–∞—Ü–∏–æ–Ω–æ–º!

    üì∏ –ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–∞–º —Ñ–æ—Ç–æ –≤–∞—à–µ–≥–æ –±–ª—é–¥–∞, –∏ –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–ª–æ—Ä–∏–π.

    üìã –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
    1. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ —Å—á—ë—Ç
    2. –°–¥–µ–ª–∞–π—Ç–µ —Ñ–æ—Ç–æ –≤–∞—à–µ–≥–æ –±–ª—é–¥–∞ –∏–ª–∏ –≤—Å–µ–≥–æ –ø—Ä–∏—ë–º–∞ –ø–∏—â–∏ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ç–æ–≤–æ–µ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏.
    3. –ò—Å–∫—É—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏ –∏ –≤–∞–∂–Ω—ã—Ö –ø–∏—Ç–∞—Ç–µ–ª—å–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤!

    –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
    1. –¢—Ä–µ–∫–∏–Ω–≥ —Ä–∞—Ü–∏–æ–Ω–∞ –≤ —Ç–µ—á–µ–Ω–∏—è –¥–Ω—è.
    2. –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è.
    3. –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –∏—Ç–æ–≥–∞–º –¥–Ω—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –±—É–¥—É—â–µ–µ.
    4. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–Ω—è (–Ω–∞–ø—Ä–∏–º–µ—Ä –µ—Å–ª–∏ –≤—ã –ª—é–±–∏—Ç–µ –∑–∞—Å–∏–∂–∏–≤–∞—Ç—å—Å—è –¥–æ –ø–æ–∑–¥–Ω–∞) –∏ –¥–Ω–µ–≤–Ω—É—é –Ω–æ—Ä–º—É –∫–∞–ª–æ—Ä–∏–π.

    ‚ùì –£ –≤–∞—Å –≤–æ–ø—Ä–æ—Å—ã?
    –ù–∞–ø–∏—à–∏—Ç–µ /help –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–æ—Ç–µ –∏ –µ–≥–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö.
            """
        await message.answer(text=text, reply_markup=main_keyboard())
    except Exception as e:
        logger.error(f"{e}")
        await message.answer(text="Some error ocured")


# @start_router.message(F.text.contains("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"))
# @start_router.message(F.text == "/register")
# async def init_user(message: Message):
#     try:
#         await register_user(message)
#         await message.answer(text="Successfully registered", reply_markup=main_keyboard())
#     except Exception as e:
#         logger.error(f"{e}")
#         await message.answer(text="Some error ocured")


@start_router.message(F.text == "/register_admin")
async def start_updating_daily_limit(message: Message, state: FSMContext):
    await state.set_state(AdminPassword.password)
    await message.reply("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞")


@start_router.message(AdminPassword.password)
async def process_energy_limit(message: Message, state: FSMContext):
    await state.clear()
    try:
        if (
            hashlib.sha256(str(message.text).encode()).hexdigest()
            == hashlib.sha256(str(ADMIN_PASSWORD).encode()).hexdigest()
        ):
            await register_user(message, role_id=3)
            await message.delete()
            await message.answer(text="–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –ø–æ–≤–µ–ª–∏—Ç–µ–ª—å")
        else:
            raise Exception("Wrong admin password")
    except Exception as e:
        logger.error(f"{e}")
        await message.delete()
        await message.answer(text="–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å, —É—Ö–æ–¥–∏")


@start_router.message(F.text.contains("–ü–æ–º–æ—â—å"))
@start_router.message(F.text == "/help")
async def help_message(message: Message):
    text = """
**üìã –ü–æ–º–æ—â—å @EasyCalloriesBot üìã**

---

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ @EasyCalloriesBot! –ú—ã –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ—á—å –≤–∞–º —Å–ª–µ–¥–∏—Ç—å –∑–∞ –≤–∞—à–∏–º –ø–∏—â–µ–≤—ã–º —Ä–∞—Ü–∏–æ–Ω–æ–º. –í–æ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –∏ —Å–ø–æ—Å–æ–±–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞—à–µ–≥–æ –±–æ—Ç–∞:

### üì∏ –ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ:

–ß—Ç–æ–±—ã –±–æ—Ç –º–æ–≥ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å –≤–∞—à–µ–≥–æ –±–ª—é–¥–∞, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. –°–¥–µ–ª–∞–π—Ç–µ —Ñ–æ—Ç–æ –≤–∞—à–µ–≥–æ –±–ª—é–¥–∞ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ç–æ–≤–æ–µ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏.
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –≤ —ç—Ç–æ—Ç —á–∞—Ç.

### üìå –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –º–µ–Ω—é

1. –°—Ç–∞—Ç—É—Å –∑–∞ –¥–µ–Ω—å - –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–∞–ª–æ—Ä–∏—è–º –∏ –ë–ñ–£ –∑–∞ –¥–µ–Ω—å
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –ú–µ–Ω—é —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞

### ‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã:

**–í: –ß–µ–º –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å @EasyCalloriesBot?**
**–û: –ë–æ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ñ–æ—Ç–æ –≤–∞—à–µ–≥–æ –±–ª—é–¥–∞ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏, –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–∏—Ç–∞—Ç–µ–ª—å–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤–∞—Ö –∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞—Ö.**

**–í: –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ, —á—Ç–æ–±—ã –∞–Ω–∞–ª–∏–∑ –±—ã–ª —Ç–æ—á–Ω—ã–º?**
**–û: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–æ—Ç–æ —á–µ—Ç–∫–æ–µ, –≤ —Ö–æ—Ä–æ—à–µ–º –æ—Å–≤–µ—â–µ–Ω–∏–∏ –∏ –Ω–∞ –Ω–µ–º –≤–∏–¥–Ω–æ –≤—Å—ë –±–ª—é–¥–æ —Ü–µ–ª–∏–∫–æ–º. –ò–∑–±–µ–≥–∞–π—Ç–µ —Ä–∞–∑–º—ã—Ç–∏—è –∏ –ø–æ–º–µ—Ö –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏. –û–¥–Ω–∞–∫–æ –ø–æ–º–Ω–∏—Ç–µ - –ë–æ—Ç –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ —á—Ç–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ –Ω–∞ —Ñ–æ—Ç–æ –∏ –º–æ–∂–µ—Ç –Ω–µ –∑–Ω–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–∏ –±–ª—é–¥–∞ –∏–ª–∏ –æ –Ω–µ–æ–±—ã—á–Ω—ã—Ö –∏–Ω–≥—Ä–∏–¥–∏–µ–Ω—Ç–∞—Ö –≤ –µ–≥–æ —Å–æ—Å—Ç–∞–≤–µ.**

**–í: –ö–∞–∫–∏–µ –µ—â–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –µ—Å—Ç—å —É –±–æ—Ç–∞?**
**–û: –ë–æ—Ç —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –æ–±—â–∏–µ —Å–æ–≤–µ—Ç—ã –ø–æ –ø–∏—Ç–∞–Ω–∏—é –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤–∞—à–∏—Ö –∞–Ω–∞–ª–∏–∑–æ–≤ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä–∞—Ü–∏–æ–Ω–∞.**
"""
    await message.answer(text=text)
